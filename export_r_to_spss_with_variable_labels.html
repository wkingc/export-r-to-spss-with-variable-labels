<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>export_r_to_spss_with_variable_labels.utf8</title>

<script src="export_r_to_spss_with_variable_labels_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="export_r_to_spss_with_variable_labels_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="export_r_to_spss_with_variable_labels_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="export_r_to_spss_with_variable_labels_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="export_r_to_spss_with_variable_labels_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="export_r_to_spss_with_variable_labels_files/navigation-1.1/tabsets.js"></script>
<script src="export_r_to_spss_with_variable_labels_files/navigation-1.1/codefolding.js"></script>
<link href="export_r_to_spss_with_variable_labels_files/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="export_r_to_spss_with_variable_labels_files/highlightjs-9.12.0/highlight.js"></script>
<link href="export_r_to_spss_with_variable_labels_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="export_r_to_spss_with_variable_labels_files/anchor-sections-1.0/anchor-sections.js"></script>
<script src="export_r_to_spss_with_variable_labels_files/kePrint-0.0.1/kePrint.js"></script>
<link href="export_r_to_spss_with_variable_labels_files/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The <i>foreign</i> R package is useful for exporting data sets to all kinds of formats including files for the proprietary <a href = "https://www.ibm.com/analytics/spss-statistics-software" target="_blank">SPSS program from IBM</a>. However, the default method for writing to SPSS doesn’t allow for variable labels. Instead, it defaults to labeling all of the variables by their name from the column headings. In this presentation, we will use the <i>Hmisc</i> R package for its variable labeling functionality and write a modification to the original SPSS export function from the <i>foreign</i> R package. If you want to test this code but don’t have SPSS, there is an open-source version available called <a href = "https://www.gnu.org/software/pspp/" target="_blank">PSPP</a>.</p>
<p>This presentation will use the R programming language and assume the user is using Rstudio to compile their R markdown files into HTML <span class="citation">(R Core Team <a href="#ref-Rlang2019" role="doc-biblioref">2019</a>; RStudio Team <a href="#ref-Rstudio" role="doc-biblioref">2016</a>)</span>. If you want to follow along with the R markdown, it is downloadable <a href="https://waderstats.com/rstudio-files/export_r_to_spss_with_variable_labels/export_r_to_spss_with_variable_labels.Rmd" target="_blank">here</a>. The associated bibliography file is <a href="https://waderstats.com/rstudio-files/export_r_to_spss_with_variable_labels/export_r_to_spss_with_variable_labels.bib" target="_blank">here</a>.</p>
</div>
<div id="libraries" class="section level1">
<h1>Libraries</h1>
<p>The libraries <i>knitr</i>, <i>bookdown</i>, and <i>kableExtra</i> generate the HTML output <span class="citation">(Xie <a href="#ref-knitr" role="doc-biblioref">2019</a>, <a href="#ref-bookdown" role="doc-biblioref">2018</a>; Zhu <a href="#ref-kableExtra" role="doc-biblioref">2019</a>)</span>. We use the <i>Hmisc</i> library to set variable labels and the <i>foreign</i> library to export the data to SPSS <span class="citation">(Harrell Jr, Charles Dupont, and others. <a href="#ref-Hmisc" role="doc-biblioref">2019</a>; R Core Team <a href="#ref-foreign" role="doc-biblioref">2018</a>)</span>.</p>
<pre class="r"><code>package_loader &lt;- function(x, ...) {
  if (x %in% rownames(installed.packages()) == FALSE) install.packages(x)
  library(x, ...)
}

packages &lt;- c(&quot;knitr&quot;, &quot;bookdown&quot;, &quot;kableExtra&quot;, &quot;Hmisc&quot;, &quot;foreign&quot;)

invisible(sapply(X = packages, FUN = package_loader, character.only = TRUE))</code></pre>
</div>
<div id="data-setup" class="section level1">
<h1>Data Setup</h1>
<p>There are two essential parts to setting up the data. First, make sure each variable is coded to reflect its class. Second, we want to add labels to each variable in the data set using the label function of the <i>Hmisc</i> library.</p>
<pre class="r"><code>set.seed(123)
data(mpg)
mpg &lt;- data.frame(mpg)

colnames(mpg)[which(colnames(mpg) == &quot;manufacturer&quot;)] &lt;- &quot;manu&quot;

mpg$manu &lt;- factor(mpg$manu)
mpg$model &lt;- factor(mpg$model)
mpg$displ &lt;- as.numeric(mpg$displ)
mpg$year &lt;- factor(mpg$year, levels = c(&quot;1999&quot;, &quot;2008&quot;), ordered = TRUE)

mpg$dp &lt;- as.Date(NA, origin = &quot;1970-01-01&quot;)
mpg$dp[which(mpg$year == &quot;1999&quot;)] &lt;- sample(seq(as.Date(&#39;1999-01-01&#39;, format = &quot;%Y-%m-%d&quot;, origin = &quot;1970-01-01&quot;), as.Date(&#39;1999-12-25&#39;, format = &quot;%Y-%m-%d&quot;, origin = &quot;1970-01-01&quot;), by=&quot;day&quot;), dim(mpg)[1]/2)
mpg$dp[which(mpg$year == &quot;2008&quot;)] &lt;- sample(seq(as.Date(&#39;2008-01-01&#39;, format = &quot;%Y-%m-%d&quot;, origin = &quot;1970-01-01&quot;), as.Date(&#39;2008-12-25&#39;, format = &quot;%Y-%m-%d&quot;, origin = &quot;1970-01-01&quot;), by=&quot;day&quot;), dim(mpg)[1]/2)

mpg$cyl &lt;- factor(mpg$cyl, levels = c(4, 5, 6, 8), ordered = TRUE)
mpg$trans &lt;- factor(mpg$trans)
mpg$drv &lt;- factor(mpg$drv, levels = c(&quot;f&quot;, &quot;r&quot;, &quot;4&quot;), labels = c(&quot;front-wheel drive&quot;, &quot;rear wheel drive&quot;, &quot;4wd&quot;))
mpg$fl &lt;- factor(mpg$fl)
mpg$class &lt;- factor(mpg$class)

mpg$rn &lt;- rnorm(dim(mpg)[1], mean = 10, sd = 5)
mpg$rn[sample(1:length(mpg$rn), size = 50)] &lt;- NA

mpg$party &lt;- factor(sample(c(&quot;republican&quot;, &quot;democrat&quot;, &quot;independent&quot;, NA), dim(mpg)[1], replace = TRUE), levels = c(&quot;republican&quot;, &quot;democrat&quot;, &quot;independent&quot;))
mpg$comments &lt;- sample(c(&quot;I like this car!&quot;, &quot;Meh.&quot;, &quot;This is the worst car ever!&quot;, &quot;Does it come in green?&quot;, &quot;want cheese flavoured cars.&quot;, &quot;Does it also fly?&quot;, &quot;Blah, Blah, Blah, Blah, Blah, Blah, Blah, Blah&quot;, NA), dim(mpg)[1], replace = TRUE)

label(mpg$manu) &lt;- &quot;manufacturer&quot;
label(mpg$model) &lt;- &quot;model name&quot;
label(mpg$displ) &lt;- &quot;engine displacement, in litres&quot;
label(mpg$year) &lt;- &quot;year of manufacture&quot;
label(mpg$dp) &lt;- &quot;date of purchase&quot;
label(mpg$cyl) &lt;- &quot;number of cylinders&quot;
label(mpg$trans) &lt;- &quot;type of transmission&quot;
label(mpg$drv) &lt;- &quot;drive type&quot;
label(mpg$cty) &lt;- &quot;city miles per gallon&quot;
label(mpg$hwy) &lt;- &quot;highway miles per gallon&quot;
label(mpg$fl) &lt;- &quot;fuel type&quot;
label(mpg$class) &lt;- &quot;type of car&quot;
label(mpg$rn) &lt;- &quot;some random numbers that are generated from a normal distrubtion with mean = 10 and sd = 5&quot;
label(mpg$party) &lt;- &quot;some random political parties&quot;
label(mpg$comments) &lt;- &quot;some random comments&quot;

kable(head(mpg), caption = &quot;Header of &lt;b&gt;mpg&lt;/b&gt;.&quot;, booktabs = TRUE, escape = FALSE) %&gt;% kable_styling(bootstrap_options = c(&quot;striped&quot;, &quot;hover&quot;, &quot;condensed&quot;, &quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ExampleDataSetup">Table 1: </span>Header of <b>mpg</b>.
</caption>
<thead>
<tr>
<th style="text-align:left;">
manu
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
displ
</th>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
cyl
</th>
<th style="text-align:left;">
trans
</th>
<th style="text-align:left;">
drv
</th>
<th style="text-align:right;">
cty
</th>
<th style="text-align:right;">
hwy
</th>
<th style="text-align:left;">
fl
</th>
<th style="text-align:left;">
class
</th>
<th style="text-align:left;">
dp
</th>
<th style="text-align:right;">
rn
</th>
<th style="text-align:left;">
party
</th>
<th style="text-align:left;">
comments
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
auto(l5)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
1999-06-28
</td>
<td style="text-align:right;">
18.98570
</td>
<td style="text-align:left;">
democrat
</td>
<td style="text-align:left;">
I like this car!
</td>
</tr>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
manual(m5)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
1999-01-14
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
I like this car!
</td>
</tr>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:left;">
2008
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
manual(m6)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
2008-02-08
</td>
<td style="text-align:right;">
19.50450
</td>
<td style="text-align:left;">
independent
</td>
<td style="text-align:left;">
Does it also fly?
</td>
</tr>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
2.0
</td>
<td style="text-align:left;">
2008
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:left;">
auto(av)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
2008-07-14
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
independent
</td>
<td style="text-align:left;">
I like this car!
</td>
</tr>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
2.8
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
auto(l5)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
1999-07-14
</td>
<td style="text-align:right;">
13.68097
</td>
<td style="text-align:left;">
democrat
</td>
<td style="text-align:left;">
Meh.
</td>
</tr>
<tr>
<td style="text-align:left;">
audi
</td>
<td style="text-align:left;">
a4
</td>
<td style="text-align:right;">
2.8
</td>
<td style="text-align:left;">
1999
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:left;">
manual(m5)
</td>
<td style="text-align:left;">
front-wheel drive
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:left;">
p
</td>
<td style="text-align:left;">
compact
</td>
<td style="text-align:left;">
1999-11-02
</td>
<td style="text-align:right;">
16.82888
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Meh.
</td>
</tr>
</tbody>
</table>
</div>
<div id="exporting-the-data-to-spss" class="section level1">
<h1>Exporting the Data to SPSS</h1>
<p>The original unexported function can be viewed with the command <b>foreign:::writeForeignSPSS</b>. We are going to create a new function called <b>writeForeignSPSS2</b>. Below is the code with comments where changes are made.</p>
<pre class="r"><code># The function below isn&#39;t exported from the foreign package, so we recreate it here.  Another option is the use the ::: operator but the documention for R discourages this use case.  We will take their word for it :).
adQuote &lt;- function(x) paste(&quot;\&quot;&quot;, x, &quot;\&quot;&quot;, sep = &quot;&quot;)

# The original function doesn&#39;t deal with dates.  To address this we need to check if the variable is of class date to later store is a character string.
is.date &lt;- function(x) inherits(x, &#39;Date&#39;)

# The original function uses the strwrap function that can sometime cause a split string to begin with a &#39;*&#39;.  This function prevents this problem.
spssSafeSplit &lt;- function(x) {
  spssSplit &lt;- strwrap(paste(x, collapse = &quot; &quot;), width = 70)
  
  spssInvalid &lt;- which(sapply(X = spssSplit, FUN = substring, 1, 1) == &quot;*&quot;)
  
  if (length(spssInvalid) == 0) return(spssSplit)
  
  for (i in 1:length(spssInvalid)) {
    spssSplit[spssInvalid[i]] &lt;- gsub(&quot;* &quot;, &quot;&quot;, spssSplit[spssInvalid[i]], fixed = TRUE)
    spssSplit[spssInvalid[i] - 1] &lt;- paste(spssSplit[spssInvalid[i] - 1], &quot;*&quot;)
  }
  
  return(spssSplit)
}

writeForeignSPSS2 &lt;- function (df, datafile, codefile, varnames = NULL, maxchars = 32L) {
  dfn &lt;- lapply(df, function(x) if (is.factor(x)) as.numeric(x) else x)
  
  # write.table(dfn, file = datafile, row.names = FALSE, col.names = FALSE, sep = &quot;,&quot;, quote = FALSE, na = &quot;&quot;, eol = &quot;,\n&quot;)
  write.table(dfn, file = datafile, row.names = FALSE, col.names = FALSE, sep = &quot;\t&quot;, quote = FALSE, na = &quot;.&quot;, eol = &quot;\n&quot;) # The original code creates a comma-delimited file.  In many data sets, there are comment columns that include commas which creates unexpected results.  To avoid that I change it over to create tab-delimited data.
  
  # varlabels &lt;- names(df)
  varlabels &lt;- label(df) # We don&#39;t want the names of df but the labels.
  
  if (is.null(varnames)) {
    varnames &lt;- abbreviate(names(df), maxchars)
    if (any(sapply(varnames, nchar) &gt; maxchars)) stop(&quot;I cannot abbreviate the variable names to &#39;maxchars&#39; or fewer chars&quot;)
    # if (any(varnames != varlabels)) warning(&quot;some variable names were abbreviated&quot;)
    if (any(varnames != names(varlabels))) warning(&quot;some variable names were abbreviated&quot;) # The original code has an error check for the max length of variable names.  We can still have the error check, but we need to use the names of varlables instead.  
  }
  
  varnames &lt;- gsub(&quot;[^[:alnum:]_\\$@#]&quot;, &quot;\\.&quot;, varnames)
  dl.varnames &lt;- varnames
  
  chv &lt;- sapply(df, is.character)
  fav &lt;- sapply(df, is.factor)
  dav &lt;- sapply(df, is.date) # This is added in to deal with date class columns.
  
  if (any(chv)) {
    lengths &lt;- sapply(df[chv], function(v) max(c(nchar(v), 8), na.rm = TRUE))
    lengths &lt;- paste0(&quot;(A&quot;, lengths, &quot;)&quot;)
    dl.varnames[chv] &lt;- paste(dl.varnames[chv], lengths)
  }
  
  # Store any date class columns as a character string in SPSS.  It is the same as above, but coerces the date to a character vector.
  if (any(dav)) {
    lengths &lt;- sapply(df[dav], function(v) max(c(nchar(as.character(v)), 8), na.rm = TRUE))
    lengths &lt;- paste0(&quot;(A&quot;, lengths, &quot;)&quot;)
    dl.varnames[dav] &lt;- paste(dl.varnames[dav], lengths)
  }
  
  if (any(fav)) {
    dl.varnames[fav] &lt;- paste(dl.varnames[fav], &quot;(F8.0)&quot;)
  }
  
  # if (any(chv) || any(fav)) {
  #     star &lt;- ifelse(c(FALSE, diff(chv | fav) == 1)[chv | fav], &quot; *&quot;, &quot; &quot;)
  #     dl.varnames[chv | fav] &lt;- paste(star, dl.varnames[chv | fav])
  # }
  
  # In the code above, the star detection isn&#39;t setup for dates.  We can add this simple enough, as shown below.
  if (any(chv) || dav || any(fav)) {
    star &lt;- ifelse(c(FALSE, diff(chv | dav | fav) == 1)[chv | dav | fav], &quot; *&quot;, &quot; &quot;)
    dl.varnames[chv | dav | fav] &lt;- paste(star, dl.varnames[chv | dav | fav])
  }

  cat(&quot;SET DECIMAL=DOT.\n\n&quot;, file = codefile)
  # cat(&quot;DATA LIST FILE=&quot;, adQuote(datafile), &quot; free (\&quot;,\&quot;)\n&quot;, file = codefile, append = TRUE)
  cat(&quot;DATA LIST FILE=&quot;, adQuote(datafile), &quot; free (TAB)\n&quot;, file = codefile, append = TRUE) # Since we changed to a tab-delmited file, we also need to change the import format to TAB.
  cat(&quot;ENCODING=\&quot;Locale\&quot;\n&quot;, file = codefile, append = TRUE)
  # cat(&quot;/&quot;, paste(strwrap(paste(dl.varnames, collapse = &quot; &quot;), width = 70), &quot;\n&quot;), &quot; .\n\n&quot;, file = codefile, append = TRUE)
  cat(&quot;/&quot;, paste(spssSafeSplit(paste(dl.varnames, collapse = &quot; &quot;)), &quot;\n&quot;), &quot; .\n\n&quot;, file = codefile, append = TRUE) # The original code forces a string wrap.  If a new line ends up begining with a &#39;*&quot; weird things happen so we use the spssSafeSplit function to prevent this.
  cat(&quot;VARIABLE LABELS\n&quot;, file = codefile, append = TRUE)
  cat(paste(varnames, adQuote(varlabels), &quot;\n&quot;), &quot;.\n&quot;, file = codefile, append = TRUE)
  
  if (any(fav)) {
    cat(&quot;\nVALUE LABELS\n&quot;, file = codefile, append = TRUE)
    for (v in which(fav)) {
      cat(&quot;/\n&quot;, file = codefile, append = TRUE)
      cat(varnames[v], &quot; \n&quot;, file = codefile, append = TRUE, sep = &quot;&quot;)
      levs &lt;- levels(df[[v]])
      cat(paste(seq_along(levs), adQuote(levs), &quot;\n&quot;, sep = &quot; &quot;), file = codefile, append = TRUE)
    }
    cat(&quot;.\n&quot;, file = codefile, append = TRUE)
  }
  
  ord &lt;- sapply(df, is.ordered)
  if (any(ord)) cat(&quot;VARIABLE LEVEL&quot;, paste(strwrap(paste(varnames[ord], collapse = &quot;, &quot;), width = 70), &quot;\n&quot;), &quot;(ordinal).\n&quot;, file = codefile, append = TRUE)
  
  num &lt;- sapply(df, is.numeric)
  
  if (any(num)) cat(&quot;VARIABLE LEVEL&quot;, paste(strwrap(paste(varnames[num], collapse = &quot;, &quot;), width = 70), &quot;\n&quot;), &quot;(scale).\n&quot;, file = codefile, append = TRUE)
  
  cat(&quot;\nEXECUTE.\n&quot;, file = codefile, append = TRUE)
}

write.foreign(mpg, datafile = &quot;export_r_to_spss_with_variable_labels.txt&quot;, codefile = &quot;export_r_to_spss_with_variable_labels.sps&quot;, package = &quot;SPSS2&quot;, maxchars = 64L)</code></pre>
<p>If you are using a console you can create you .sav file with the following commands, otherwise if you are using the GUI, click away!</p>
<pre class="r"><code>cat(&quot;\nSAVE OUTFILE = \&quot;export_r_to_spss_with_variable_labels.sav\&quot;.&quot;, file = &quot;export_r_to_spss_with_variable_labels.sps&quot;, append = TRUE)

system(&quot;pspp export_r_to_spss_with_variable_labels.sps&quot;)</code></pre>
<p>If you want to run the output yourself the data file can be downloaded <a href="https://waderstats.com/rstudio-files/export_r_to_spss_with_variable_labels/export_r_to_spss_with_variable_labels.txt" target="_blank">here</a> and the code file can be downloaded <a href="https://waderstats.com/rstudio-files/export_r_to_spss_with_variable_labels/export_r_to_spss_with_variable_labels.sps" target="_blank">here</a>. If you want to download the final .sav data set, it is <a href="https://waderstats.com/rstudio-files/export_r_to_spss_with_variable_labels/export_r_to_spss_with_variable_labels.sav" target="_blank">here</a>.</p>
</div>
<div id="session-info" class="section level1">
<h1>Session Info</h1>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 4.0.3 (2020-10-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.1 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       
##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   
##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          
## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   
## 
## attached base packages:
## [1] stats     graphics  grDevices datasets  utils     methods   base     
## 
## other attached packages:
## [1] foreign_0.8-80   Hmisc_4.4-1      ggplot2_3.3.2    Formula_1.2-4   
## [5] survival_3.2-7   lattice_0.20-41  kableExtra_1.3.1 bookdown_0.21   
## [9] knitr_1.30      
## 
## loaded via a namespace (and not attached):
##  [1] xfun_0.19           splines_4.0.3       colorspace_2.0-0   
##  [4] vctrs_0.3.5         htmltools_0.5.0     viridisLite_0.3.0  
##  [7] yaml_2.2.1          base64enc_0.1-3     rlang_0.4.8        
## [10] pillar_1.4.6        glue_1.4.2          withr_2.3.0        
## [13] RColorBrewer_1.1-2  jpeg_0.1-8.1        lifecycle_0.2.0    
## [16] stringr_1.4.0       munsell_0.5.0       gtable_0.3.0       
## [19] rvest_0.3.6         htmlwidgets_1.5.2   evaluate_0.14      
## [22] latticeExtra_0.6-29 htmlTable_2.1.0     backports_1.2.0    
## [25] checkmate_2.0.0     renv_0.12.2         scales_1.1.1       
## [28] webshot_0.5.2       gridExtra_2.3       png_0.1-7          
## [31] digest_0.6.27       stringi_1.5.3       grid_4.0.3         
## [34] tools_4.0.3         magrittr_2.0.1      tibble_3.0.4       
## [37] cluster_2.1.0       crayon_1.3.4        pkgconfig_2.0.3    
## [40] ellipsis_0.3.1      Matrix_1.2-18       data.table_1.13.2  
## [43] xml2_1.3.2          rmarkdown_2.5       httr_1.4.2         
## [46] rstudioapi_0.13     R6_2.5.0            rpart_4.1-15       
## [49] nnet_7.3-14         compiler_4.0.3</code></pre>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<!-- This is needed to resize iframe content. Please ignore if duplicationg this R markdown file -->
<script type="text/javascript" src="https://www.waderstats.com/wp-includes/js/iframe-resizer/js/iframeResizer.contentWindow.min.js" defer></script>
<div id="refs" class="references">
<div id="ref-Hmisc">
<p>Harrell Jr, Frank E, with contributions from Charles Dupont, and many others. 2019. <em>Hmisc: Harrell Miscellaneous</em>. <a href="https://CRAN.R-project.org/package=Hmisc">https://CRAN.R-project.org/package=Hmisc</a>.</p>
</div>
<div id="ref-foreign">
<p>R Core Team. 2018. <em>Foreign: Read Data Stored by ’Minitab’, ’S’, ’Sas’, ’Spss’, ’Stata’, ’Systat’, ’Weka’, ’dBase’, ...</em> <a href="https://CRAN.R-project.org/package=foreign">https://CRAN.R-project.org/package=foreign</a>.</p>
</div>
<div id="ref-Rlang2019">
<p>———. 2019. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-Rstudio">
<p>RStudio Team. 2016. <em>RStudio: Integrated Development Environment for R</em>. Boston, MA: RStudio, Inc. <a href="http://www.rstudio.com/">http://www.rstudio.com/</a>.</p>
</div>
<div id="ref-bookdown">
<p>Xie, Yihui. 2018. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. <a href="https://github.com/rstudio/bookdown">https://github.com/rstudio/bookdown</a>.</p>
</div>
<div id="ref-knitr">
<p>———. 2019. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in R</em>. <a href="https://yihui.name/knitr/">https://yihui.name/knitr/</a>.</p>
</div>
<div id="ref-kableExtra">
<p>Zhu, Hao. 2019. <em>KableExtra: Construct Complex Table with ’Kable’ and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "export_r_to_spss_with_variable_labels_files/mathjax-local/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
